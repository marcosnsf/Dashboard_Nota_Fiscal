<!DOCTYPE html>
<html>

<head>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    

    <link rel="stylesheet" type="text/css" href="/public/css/menu.css">
    
    <link rel="stylesheet" href="/public/css/estilo.css">
    <script type=" text/javascript" src="/public/js/materialize.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
    <nav>
        <a href="#" data-target="slide-out" class="sidenav-trigger left-align">
            <i class="material-icons">menu</i>
        </a> 
        <div class="nav-wrapper">
            <a href="#" class="brand-logo">Cadastrar serviço</a>
        </div>
    </nav>
  <ul id="slide-out" class="sidenav">
        {{!-- <li><a href="/dashboard"><i class="material-icons">home</i>Home</a></li>
        <li>
            <div class="divider"></div>
        </li> --}}
      
        <li>
            <a class="subheader" id="icon_blue">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bag-plus" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 7.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0v-1.5H6a.5.5 0 0 1 0-1h1.5V8a.5.5 0 0 1 .5-.5z"/>
                    <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5z"/>
                </svg>
               <span> Produtos</span>
            </a>
        </li>
        <li>
            <a href="/produtos/cadastrar" class="waves-effect" id="icon_blue">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                </svg>
                <span>Cadastrar</span>  
            </a>
        </li>
        <li>
            <a href="/produtos/listar" class="waves-effect " id="icon_blue" >
               <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list " viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                </svg>
               <span> Listar</span>
            </a>
        </li>
         <li>
            <a href="http://10.0.42.229:8081/" target="_blank" class="waves-effect" id="icon_blue">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
                <span> Consultar Produtos</span>
            </a>
        </li>
        <li>
            <div class="divider"></div>
        </li>
        <li>
            <li>
            <a class="subheader" id="icon_green">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bag-plus" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 7.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0v-1.5H6a.5.5 0 0 1 0-1h1.5V8a.5.5 0 0 1 .5-.5z"/>
                    <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5z"/>
                </svg>
               <span> Serviços</span>
            </a>
        </li>
        <li>
            <a href="/produtos/cadastrarServicos" class="waves-effect" id="icon_green">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                </svg>
                <span>Cadastrar</span>  
            </a>
        </li>
        <li>
            <a href="/produtos/listarServicos" class="waves-effect " id="icon_green" >
               <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list " viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                </svg>
               <span> Listar</span>
            </a>
        </li>
        <li>
            <a href="http://10.0.42.229:8081/servicos" target="_blank" class="waves-effect" id="icon_green">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                </svg>
                <span> Consultar Serviços</span>
            </a>
        </li>
        <li>
            <div class="divider"></div>
        </li>
        <li>
            <a class="subheader" id="icon_blue">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-building" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M14.763.075A.5.5 0 0 1 15 .5v15a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5V14h-1v1.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V10a.5.5 0 0 1 .342-.474L6 7.64V4.5a.5.5 0 0 1 .276-.447l8-4a.5.5 0 0 1 .487.022zM6 8.694 1 10.36V15h5V8.694zM7 15h2v-1.5a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 .5.5V15h2V1.309l-7 3.5V15z"/>
                    <path d="M2 11h1v1H2v-1zm2 0h1v1H4v-1zm-2 2h1v1H2v-1zm2 0h1v1H4v-1zm4-4h1v1H8V9zm2 0h1v1h-1V9zm-2 2h1v1H8v-1zm2 0h1v1h-1v-1zm2-2h1v1h-1V9zm0 2h1v1h-1v-1zM8 7h1v1H8V7zm2 0h1v1h-1V7zm2 0h1v1h-1V7zM8 5h1v1H8V5zm2 0h1v1h-1V5zm2 0h1v1h-1V5zm0-2h1v1h-1V3z"/>
                </svg>
               <span> Fornecedores</span>
             </a>
        </li>
        <li>
            <a href="/fornecedores/cadastrar" class="waves-effect" id="icon_blue">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                </svg>
                <span>Cadastrar</span>
            </a>
        </li>
        <li>
            <a href="/fornecedores/listar" class="waves-effect" id="icon_blue">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list " viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                </svg>
               <span> Listar</span>
            </a>
        </li>
        <li>
            <div class="divider"></div>
        </li>
        <li>
            <a class="subheader" id="icon_green">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tags" viewBox="0 0 16 16">
                    <path d="M3 2v4.586l7 7L14.586 9l-7-7H3zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586V2z"/>
                    <path d="M5.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1zm0 1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM1 7.086a1 1 0 0 0 .293.707L8.75 15.25l-.043.043a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 0 7.586V3a1 1 0 0 1 1-1v5.086z"/>
                </svg>
                <span>Secretarias</span>
            </a>
        </li>
        <li>
            <a href="/categorias/cadastrar" class="waves-effect" id="icon_green">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                </svg>
                <span>Cadastrar</span> 
            </a>
        </li>
        <li>
            <a href="/categorias/listar" class="waves-effect" id="icon_green">
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-list " viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                </svg>
                <span> Listar</span>
            </a>
        </li>

        <li>
            <div class="divider"></div>
        </li>

       
        {{!-- <li><a class="subheader"><i class="material-icons">attach_money</i>Venda</a></li>
        <li><a href="/vendas/cadastrar" class="waves-effect"><i class="material-icons">add_shopping_cart</i>Nova
                venda</a>
        </li>
        </li> --}}
            <div class="divider"></div>
        </li>
        <li>
            <a href="/login" class="waves-effect" id="icon_red">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                    <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                </svg>
                <span>Sair</span>
            </a>
        </li>
        <li>
            <div class="divider"></div>
        </li>
        
    </ul>

    <br />
    
    <div class="container">
        <div class="row">
            <div class="col s12">
                <div class="card col s12">
                    <form class="col s12" action="uploads/" method="post" enctype="multipart/form-data" >
                        {{!-- primeira linha --}}
                        <div class="row" >
                            <div class="input-field col s6">
                                <input  id="datanf1" name="datanf1" required
                                    type="date" class="validate">
                                <label for="datanf1">Data emissão Nota Fiscal:</label>
                            </div>
                            <div class="input-field col s6">
                                <input placeholder="N° Nota Fiscal" id="numnf1" name="numnf1" required type="text"
                                    class="validate">
                                <label for="numnf1">N° Nota Fiscal:</label>
                            </div>
                        </div>
                        {{!-- ---- fim ----- --}}
                        {{!-- segunda linha --}}
                        <div class="row">
                            <div class="input-field col s6">
                                <input placeholder="N° Empenho" id="numemp1" name="numemp1" required type="text"
                                    class="validate">
                                <label for="numemp1">N° Empenho:</label>
                            </div>
                            <div class="input-field col s6">
                                <input placeholder="N° Nota Fiscal" id="numpedido1" name="numpedido1" required type="text"
                                    class="validate">
                                <label for="numpedido1">N° pedido Nota Fiscal:</label>
                            </div>
                        </div>
                        {{!-- ---- fim ----- --}}
                        {{!-- terceira linha --}}
                        <div class="row">
                            <div class="input-field col s6">
                                <input placeholder="N° Contrato" id="numcontrato1" name="numcontrato1" required type="text"
                                    class="validate">
                                <label for="numcontrato1">N° Contrato:</label>
                            </div>
                            <div class="input-field col s6">
                                <input  id="datareceb1" name="datareceb1" required
                                    type="date" class="validate">
                                <label for="datareceb1">Data recebimento Nota Fiscal:</label>
                            </div>
                            
                        </div>
                        {{!-- ---- fim ----- --}}
                        {{!-- quarta linha --}}
                        <div class="row">
                            <div class="input-field col s6">
                                <input placeholder="Preço" id="valorVenda1" name="valorVenda1" required type="number"
                                    class="validate">
                                <label for="valorVenda1">Valor da nota</label>
                            </div>
                            <div class="input-field col s6">
                                <div class="file-field ">
                                    <div class="btn">
                                        <span>Nota Fiscal</span>
                                        <input type="file" name="arquivonf" id="arquivonf">
                                    </div>
                                    <div class="file-path-wrapper">
                                        <input class="file-path validate" type="text" name="arquivonf" id="arquivonf">
                                    </div>
                                    
                                </div>
                                
                            </div>
                            
                        </div>
                        {{!-- ---- fim ----- --}}
                        {{!-- quinta linha --}}
                        <div class="row">
                            <div class="input-field col s6">
                                <div class="file-field ">
                                    <div class="btn">
                                        <span>Laudo</span>
                                        <input type="file" name="arquivolaudo" id="arquivolaudo">
                                    </div>
                                    <div class="file-path-wrapper">
                                        <input class="file-path validate" type="text" name="arquivolaudo" id="arquivolaudo">
                                    </div>
                                    
                                </div>
                                
                            </div>
                            <div class="input-field col s6">
                                <select required name="categoria" id="categoria">
                                    <option value="" disabled selected>Selecione a categoria</option>
                                    {{#categorias}}
                                    <option value='{{this}}'>{{this}}</option>
                                    {{/categorias}}
                                </select>
                                <label>Secretaria</label>
                            </div>
                            
                        </div>
                        {{!-- ---- fim ----- --}}
                        {{!-- sexta linha --}}
                         <div class="row">
                             <div class="input-field col s6">
                                <select required name="fornecedor" id="fornecedor">
                                    <option value="" disabled selected>Selecione o fornecedor</option>
                                    {{#fornecedores}}
                                    <option value='{{this}}'>{{this}}</option>
                                    {{/fornecedores}}
                                </select>
                                <label>Fornecedor</label>
                            </div>
                            <div class="input-field col s6">
                                <select required name="situacao" id="situacao">
                                    <option value="" disabled selected>Selecione o status da venda</option>
                                    {{#situacoes}}
                                    <option value={{this}}>{{this}}</option>
                                    {{/situacoes}}
                                </select>
                                <label>Situação</label>
                            </div>
                            
                        </div> 
                        {{!-- ---- fim ----- --}}
                        {{!-- setima linha --}}
                        <div class="row">
                            <div class="input-field col s6">
                                <select required name="aprovacao" id="aprovacao">
                                    <option value="" disabled selected>Selecione o status da aprovação</option>
                                    {{#aprovacoes}}
                                    <option value={{this}}>{{this}}</option>
                                    {{/aprovacoes}}
                                </select>
                                <label>Aprovação</label>
                            </div>
                            <div class="input-field col s6">
                                <input placeholder="" id="pedidocompra1" name="pedidocompra1" required type="text"
                                    class="validate">
                                <label for="pedidocompra1">Pedido de compra:</label>
                            </div>
                        </div>
                        {{!-- ---- fim ----- --}}
                        {{!-- oitava linha --}}
                        <div class="row">
                            <div class="input-field col s6">
                                <input placeholder="Ex:usuario.acesso" id="operador1" name="operador1" required type="text"
                                    class="validate">
                                <label for="operador1">Ultimo operador da nota</label>
                            </div>
                            {{!-- <div class="input-field col s6">
                                <input  id="dtmodificacao1" name="dtmodificacao1" required
                                    type="date" class="validate" pattern="[0-9]{2}-[0-9]{2}-[0-9]{4}">
                                <label for="dtmodificacao1">Data de ultima modificação:</label>
                            </div> --}}
                        </div>
                        {{!-- fim --}}

                        <div class="row">

                            <div class="input-field col s12">
                                <textarea placeholder="Observações" id="observation1" name="observation1" required type="text"
                                    class="validate materialize-textarea">
                                </textarea>
                                <label for="observation1">Observações:</label>
                            </div>

                        </div>
                        
                        
                        
                        
                        <div class="row col s6">
                            <button class="btn waves-effect waves-light btn-style" id="button" type="submit" onclick="save()"
                                name="arquivo">Salvar</button>
                            <div id="loading" class="preloader-wrapper big active">
                                <div class="spinner-layer spinner-blue-only">
                                    <div class="circle-clipper left">
                                        <div class="circle"></div>
                                    </div>
                                    <div class="gap-patch">
                                        <div class="circle"></div>
                                    </div>
                                    <div class="circle-clipper right">
                                        <div class="circle"></div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        {{!-- ---- fim ----- --}}
                    </form>
                </div>
                <h6 style="color:green" id="success" />
                <h6 style="color:red" id="error" />
            </div>
        </div>
    </div>
    
                <h6 style="color:green" id="success" />
                <h6 style="color:red" id="error" />
            </div>
        </div>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    var token = localStorage.getItem('token');
    document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('.sidenav');
        var instances = M.Sidenav.init(elems, null);
    });

    document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('select');
        var instances = M.FormSelect.init(elems, null);
    });

    document.getElementById('loading').style.display = "none";
    function isEdicao() {
        var url = window.location.pathname.split('cadastrarServicos/')[1]
        return url !== null && url !== undefined;
    }

    function getId() {
        if (isEdicao()) {
            return window.location.pathname.split('cadastrarServicos/')[1]
        }
    }

    if (isEdicao()) {
        getServico(getId())
    }

    async function getServico(id) {
        axios.get(`/api/servico/${id}`, { headers: { authorization: `Bearer ${token}` } })
            .then(res => {
                document.getElementById("datanf1").value = res.data.datanf1;
                document.getElementById("numnf1").value = res.data.numnf1;
                document.getElementById("numemp1").value = res.data.numemp1;
                document.getElementById("numpedido1").value = res.data.numpedido1;
                document.getElementById("numcontrato1").value = res.data.numcontrato1; 
                document.getElementById("datareceb1").value = res.data.datareceb1;
                document.getElementById("valorVenda1").value = res.data.valorVenda1;
                document.getElementById("fornecedor").value = `${res.data.fornecedorRazaoSocial} - ${res.data.fornecedorCnpj}`;
                document.getElementById("categoria").value = `${res.data.secretaria} - ${res.data.gestor}`;
                // 
                document.getElementById("operador1").value = res.data.operador1; 
                //
                document.getElementById("pedidocompra1").value = res.data.pedidocompra1; 
                 // 
                //document.getElementById("dtmodificacao1").value = res.data.dtmodificacao; 
                //
                document.getElementById("observation1").value = res.data.observation1;
            })
            .catch(error => {
                document.getElementById('success').innerHTML = ''
                document.getElementById('error').innerHTML = error.response.data.message
            })
    }

    document.getElementById("button").addEventListener("click", function (event) {
        event.preventDefault()
    });
    async function save() {
        document.getElementById('button').style.display = "none";
        document.getElementById('loading').style.display = "block";
        var object = {};
        new FormData(document.querySelector('form'))
            .forEach(function (value, key) {
                console.log(value)
                object[key] = value;
            });
        if (isEdicao()) {
            await axios.put(`/api/servicos/${getId()}`, object, { headers: { authorization: `Bearer ${token}` } })
                .then(data => {
                    window.location.href = '/produtos/listarServicos'
                })
                .catch(error => {
                    document.getElementById('success').innerHTML = ''
                    document.getElementById('error').innerHTML = error.response.data.message
                })
        } else {
            await axios.post('/api/servicos', object, { headers: { authorization: `Bearer ${token}` } })
                .then(data => {
                    window.location.href = '/produtos/listarServicos'
                })
                .catch(error => {
                    document.getElementById('success').innerHTML = ''
                    document.getElementById('error').innerHTML = error.response.data.message
                })
        }
        document.getElementById('loading').style.display = "none";
        document.getElementById('button').style.display = "block";
    }
</script>

</html>